<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:models="clr-namespace:MauiExamApp.Models"
             xmlns:viewModels="clr-namespace:MauiExamApp.ViewModels"
             x:DataType="viewModels:DashboardViewModel"
             x:Class="MauiExamApp.Views.DashboardView"
             Title="Dashboard">
    <Grid>
        <!-- Primært indhold -->
        <ScrollView>
            <VerticalStackLayout Spacing="15" Padding="15">

                <!-- Rediger/Opret Eksamen Formular -->
                <Frame Padding="10" CornerRadius="10" BorderColor="LightGray">
                    <VerticalStackLayout Spacing="10">
                        <Grid ColumnDefinitions="*,Auto">
                            <Label Grid.Column="0" Text="{Binding FormTitle}" FontSize="Large" FontAttributes="Bold" VerticalOptions="Center"/>
                            <Button Grid.Column="1" Text="Annuller Redigering" Command="{Binding CancelEditExamCommand}" IsVisible="{Binding IsEditingExam}"/>
                        </Grid>
                        
                        <Entry Placeholder="Eksamenstermin (f.eks. 'sommer 25')" Text="{Binding Term}"/>
                        <Entry Placeholder="Kursusnavn" Text="{Binding CourseName}"/>
                        <DatePicker Date="{Binding Date}"/>
                        <TimePicker Time="{Binding StartTime}" />
                        <Entry Placeholder="Antal Spørgsmål" Keyboard="Numeric" Text="{Binding NumberOfQuestions}"/>
                        <Entry Placeholder="Eksamenstid (minutter)" Keyboard="Numeric" Text="{Binding ExamDurationMinutes}"/>
                        
                        <Button Text="{Binding FormButtonText}" Command="{Binding SaveExamCommand}"/>
                    </VerticalStackLayout>
                </Frame>
                
                <!-- Liste over Kommende Eksamener -->
                <Label Text="Kommende Eksamener" FontSize="Large" FontAttributes="Bold" Margin="0,20,0,0"/>
                <CollectionView ItemsSource="{Binding UpcomingExams}">
                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="models:Exam">
                            <Frame Padding="15" CornerRadius="10" Margin="0,5" BorderColor="LightGray">
                                <Grid RowSpacing="10">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <Label Grid.Row="0" Grid.Column="0" Text="{Binding CourseName}" FontSize="Medium" FontAttributes="Bold"/>
                                    <Label Grid.Row="1" Grid.Column="0" Text="{Binding Term}" FontAttributes="Italic"/>
                                    <Label Grid.Row="2" Grid.Column="0" Text="{Binding Date, StringFormat='{0:d. MMMM}'}"/>

                                    <VerticalStackLayout Grid.Row="0" Grid.RowSpan="3" Grid.Column="1" Spacing="5" VerticalOptions="Center">
                                        <Button Text="Start" Command="{Binding Source={RelativeSource AncestorType={x:Type viewModels:DashboardViewModel}}, Path=GoToExamCommand}" CommandParameter="{Binding .}"/>
                                        <Button Text="Studerende" Command="{Binding Source={RelativeSource AncestorType={x:Type viewModels:DashboardViewModel}}, Path=ShowStudentPopupCommand}" CommandParameter="{Binding .}"/>
                                        <Button Text="Rediger" Command="{Binding Source={RelativeSource AncestorType={x:Type viewModels:DashboardViewModel}}, Path=EditExamCommand}" CommandParameter="{Binding .}"/>
                                        <Button Text="Slet" Command="{Binding Source={RelativeSource AncestorType={x:Type viewModels:DashboardViewModel}}, Path=DeleteExamCommand}" CommandParameter="{Binding .}" BackgroundColor="Red"/>
                                    </VerticalStackLayout>
                                </Grid>
                            </Frame>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>

            </VerticalStackLayout>
        </ScrollView>

        <!-- Pop-up for Studerende -->
        <Border Stroke="#DDDDDD" StrokeThickness="1" BackgroundColor="#AA000000"
                IsVisible="{Binding IsStudentPopupVisible}" ZIndex="1">
            <Frame VerticalOptions="Center" HorizontalOptions="Center" WidthRequest="340" Padding="0" CornerRadius="10">
                <VerticalStackLayout>
                    <!-- Header -->
                    <Grid Padding="15" ColumnSpacing="10">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <Label Grid.Column="0" Text="Tilmeldte Studerende" FontSize="Medium" FontAttributes="Bold" VerticalOptions="Center"/>
                        <Button Grid.Column="1" Text="X" FontSize="Medium" Command="{Binding HideStudentPopupCommand}" Padding="10,5"/>
                    </Grid>
                    
                    <BoxView HeightRequest="1" Color="LightGray"/>

                    <!-- Liste og Tilføj Formular -->
                    <VerticalStackLayout Padding="15" Spacing="15">
                        <!-- Liste over studerende -->
                        <CollectionView ItemsSource="{Binding StudentsForSelectedExam}" HeightRequest="150">
                            <CollectionView.ItemTemplate>
                                <DataTemplate x:DataType="models:Student">
                                    <Grid ColumnDefinitions="*,Auto" Padding="0,5">
                                        <HorizontalStackLayout Grid.Column="0" Spacing="10">
                                            <Label Text="{Binding Order, StringFormat='{0}.'}" FontAttributes="Bold"/>
                                            <Label Text="{Binding FullName}"/>
                                            <Label Text="{Binding StudentNumber, StringFormat='({0})'}" TextColor="Gray"/>
                                        </HorizontalStackLayout>
                                        <Button Grid.Column="1" Text="Slet" Command="{Binding Source={RelativeSource AncestorType={x:Type viewModels:DashboardViewModel}}, Path=DeleteStudentCommand}" CommandParameter="{Binding .}" BackgroundColor="DarkRed" Padding="5"/>
                                    </Grid>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>
                        
                        <BoxView HeightRequest="1" Color="LightGray"/>

                        <!-- Tilføj ny studerende -->
                        <Label Text="Tilføj Ny Studerende" FontAttributes="Bold"/>
                        <Entry Placeholder="Studienummer" Text="{Binding NewStudentNumber}"/>
                        <Entry Placeholder="Fulde Navn" Text="{Binding NewStudentName}"/>
                        <Button Text="Tilføj Studerende" Command="{Binding AddStudentCommand}"/>
                    </VerticalStackLayout>
                </VerticalStackLayout>
            </Frame>
        </Border>
    </Grid>
</ContentPage>